#!/bin/bash

# File path for dependencies
dep_file_path="deps.txt";

install_dependencies() {
  # Installs all dependencies listed in the file at $file_path
  npm install &> /dev/null || { echo "Failed to install dependencies"; exit 1; }
  local file_path="$1"
  local num_installed=1

  # Check if the file exists
  if [ ! -f "$file_path" ]; then
    echo "Dependency file not found: $file_path, ensure that it exists."
    exit 1;
  fi

  while IFS= read -r line || [[ -n "$line" ]]; do 
    npm install $line &> /dev/null || { echo "Failed to install $line"; exit 1; }
    ((num_installed++))
  done < "$file_path"

  echo "$num_installed dependencies installed..."
}

if [ "$1" == "install" ]; then
  # Install Node.js dependencies
  install_dependencies "$dep_file_path"
  exit 0
elif [ "$1" == "test" ]; then
  # Run Jest tests
  npx jest
  # Placeholder for testing command
  echo "X/Y test cases passed. Z% line coverage achieved."
  exit 0
else
  if [ -f "$1" ]; then
    ts-node ./run_URL_FILE/fetch_url.ts "$1";
    exit 0;
  else
    echo "URL file $1 not found";
    exit 1;
  fi
fi
